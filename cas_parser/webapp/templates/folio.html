<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Famfolio - Investment Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .info-card {
            border-left: 4px solid #667eea;
        }
        .stat-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        .stat-box h3 {
            color: #667eea;
            margin-bottom: 0;
        }
        .table-responsive { max-height: 600px; overflow-y: auto; }
        .badge-purchase { background-color: #28a745; }
        .badge-sip { background-color: #17a2b8; }
        .badge-redemption { background-color: #dc3545; }
        .badge-switch_in { background-color: #6f42c1; }
        .badge-switch_out { background-color: #fd7e14; }
        .badge-stamp_duty { background-color: #6c757d; }
        .badge-stt { background-color: #6c757d; }
        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        body.mask-amounts .mask-amount {
            filter: blur(8px);
            user-select: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <a href="javascript:history.back()" class="text-white text-decoration-none">
                        <i class="bi bi-arrow-left"></i> Back
                    </a>
                    <h1 class="mt-3" id="schemeName">Loading...</h1>
                    <p class="mb-0" id="schemeDetails"></p>
                    <div class="mt-2 d-flex align-items-center gap-2" id="investorMapping">
                        <span id="investorBadge"></span>
                        <select class="form-select form-select-sm d-none" id="reassignSelect" style="width: auto; max-width: 250px;">
                            <option value="">-- Reassign to --</option>
                        </select>
                        <button class="btn btn-sm btn-outline-light d-none" id="reassignBtn" onclick="reassignFolio()">
                            <i class="bi bi-arrow-repeat"></i> Reassign
                        </button>
                        <button class="btn btn-sm btn-outline-warning d-none" id="unmapBtn" onclick="unmapFolio()">
                            <i class="bi bi-x-circle"></i> Unmap
                        </button>
                        <button class="btn btn-sm btn-outline-success d-none" id="mapBtn" onclick="showMapControls()">
                            <i class="bi bi-link-45deg"></i> Map to Investor
                        </button>
                    </div>
                </div>
                <button class="btn btn-outline-light" id="maskToggle" onclick="toggleMask()" title="Toggle amount visibility">
                    <i class="bi bi-eye" id="maskIcon"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Investment Info -->
        <div class="card info-card shadow-sm mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">Current Value</small>
                            <h3 id="currentValue" class="mask-amount">-</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">Units</small>
                            <h3 id="units">-</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">NAV</small>
                            <h3 id="nav">-</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">NAV Date</small>
                            <h3 id="navDate">-</h3>
                        </div>
                    </div>
                </div>
                <hr class="my-2">
                <div class="row">
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">Invested</small>
                            <h3 id="investedValue" class="mask-amount">-</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">Redeemed</small>
                            <h3 id="redeemedValue" class="mask-amount">-</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">Gain/Loss</small>
                            <h3 id="gainLoss" class="mask-amount">-</h3>
                            <small id="gainLossPct" class="mask-amount"></small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-box">
                            <small class="text-muted">XIRR (Annualized)</small>
                            <h3 id="folioXirr">-</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions -->
        <div class="card shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Transaction History</h5>
                <span class="badge bg-primary" id="txCount">0 transactions</span>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="txTypeFilter">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="txSearch" placeholder="Search...">
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th class="text-end">Amount</th>
                                <th class="text-end">Units</th>
                                <th class="text-end">NAV</th>
                                <th class="text-end">Balance</th>
                                <th class="text-end">Running Units</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil"></i> Edit Transaction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editTxId">
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-control" id="editDate">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Type</label>
                            <select class="form-select" id="editType">
                                <option value="purchase">Purchase</option>
                                <option value="sip">SIP</option>
                                <option value="redemption">Redemption</option>
                                <option value="switch_in">Switch In</option>
                                <option value="switch_out">Switch Out</option>
                                <option value="dividend_payout">Dividend Payout</option>
                                <option value="dividend_reinvestment">Dividend Reinvestment</option>
                                <option value="stamp_duty">Stamp Duty</option>
                                <option value="stt">STT</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-control" id="editDescription">
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label">Amount</label>
                            <input type="number" step="0.01" class="form-control" id="editAmount">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Units</label>
                            <input type="number" step="0.0001" class="form-control" id="editUnits">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label">NAV</label>
                            <input type="number" step="0.0001" class="form-control" id="editNav">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Balance Units</label>
                            <input type="number" step="0.0001" class="form-control" id="editBalance">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Edit Comment <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="editComment" rows="2" placeholder="Why are you making this change?" required></textarea>
                        <small class="text-muted">Required: Explain the reason for this edit</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTransaction()">
                        <i class="bi bi-check-lg"></i> Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version History Modal -->
    <div class="modal fade" id="versionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-clock-history"></i> Version History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="versionsList">
                        <!-- Versions will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mask amounts functionality
        function isMaskEnabled() {
            return localStorage.getItem('maskAmounts') === 'true';
        }

        function toggleMask() {
            const currentState = isMaskEnabled();
            localStorage.setItem('maskAmounts', !currentState);
            applyMask();
        }

        function applyMask() {
            const masked = isMaskEnabled();
            const icon = document.getElementById('maskIcon');

            if (masked) {
                document.body.classList.add('mask-amounts');
                if (icon) icon.className = 'bi bi-eye-slash';
            } else {
                document.body.classList.remove('mask-amounts');
                if (icon) icon.className = 'bi bi-eye';
            }
        }

        // Apply mask on page load
        applyMask();

        const folioId = {{ folio_id }};
        let allTransactions = [];

        async function loadData() {
            try {
                // Load folio info (units, NAV, NAV date from holdings)
                const infoRes = await fetch(`/api/folios/${folioId}/info`);
                const folioInfo = await infoRes.json();
                if (folioInfo && !folioInfo.error) {
                    document.getElementById('schemeName').textContent = folioInfo.scheme_name || 'Unknown Scheme';
                    document.getElementById('schemeDetails').textContent =
                        `Folio: ${folioInfo.folio_number}`;
                    document.getElementById('units').textContent = (folioInfo.units || 0).toFixed(3);
                    document.getElementById('nav').textContent = folioInfo.nav ? folioInfo.nav.toFixed(4) : '-';
                    document.getElementById('navDate').textContent = folioInfo.nav_date || '-';
                }

                // Load transactions
                const txRes = await fetch(`/api/folios/${folioId}/transactions`);
                allTransactions = await txRes.json();

                // Override units display with computed sum from transactions
                const computedUnits = allTransactions.reduce((sum, t) => sum + (t.units || 0), 0);
                document.getElementById('units').textContent = computedUnits.toFixed(3);

                displayTransactions(allTransactions);
                populateFilters(allTransactions);

                // Calculate invested and redeemed from transactions
                // Use signed amounts: negative-amount purchases are reversals (reduce invested),
                // negative-amount redemptions are actual redemption proceeds
                let totalInvested = 0;
                let totalRedeemed = 0;
                allTransactions.forEach(t => {
                    const type = t.tx_type || '';
                    const amt = t.amount || 0;
                    if (['purchase', 'sip', 'switch_in'].includes(type)) {
                        totalInvested += amt;
                    } else if (['redemption', 'switch_out'].includes(type)) {
                        totalRedeemed += Math.abs(amt);
                    }
                });

                // Load XIRR data
                try {
                    const xirrRes = await fetch(`/api/folios/${folioId}/xirr`);
                    const xirrData = await xirrRes.json();

                    const currentVal = xirrData.current_value || 0;
                    if (currentVal > 0) {
                        document.getElementById('currentValue').textContent = formatCurrency(currentVal);
                    }

                    document.getElementById('investedValue').textContent = formatCurrency(totalInvested);
                    document.getElementById('redeemedValue').textContent = formatCurrency(totalRedeemed);
                    const gain = currentVal + totalRedeemed - totalInvested;
                    const gainPct = totalInvested > 0 ? ((gain / totalInvested) * 100).toFixed(1) : 0;
                    const gainEl = document.getElementById('gainLoss');
                    const gainPctEl = document.getElementById('gainLossPct');
                    gainEl.textContent = (gain >= 0 ? '+' : '') + formatCurrency(gain);
                    gainPctEl.textContent = `(${gain >= 0 ? '+' : ''}${gainPct}%)`;
                    gainEl.style.color = gain >= 0 ? '#38ef7d' : '#ff4b2b';
                    gainPctEl.style.color = gain >= 0 ? '#38ef7d' : '#ff4b2b';

                    const xirrEl = document.getElementById('folioXirr');
                    if (xirrData.xirr !== null && xirrData.xirr !== undefined) {
                        const xirrVal = xirrData.xirr;
                        xirrEl.textContent = (xirrVal >= 0 ? '+' : '') + xirrVal.toFixed(2) + '%';
                        xirrEl.style.color = xirrVal >= 0 ? '#38ef7d' : '#ff4b2b';
                    } else {
                        xirrEl.textContent = 'N/A';
                        xirrEl.style.color = '#888';
                    }
                } catch (e) {
                    console.error('Failed to load XIRR:', e);
                }

            } catch (error) {
                console.error('Failed to load data:', error);
            }
        }

        function displayTransactions(transactions) {
            const tbody = document.getElementById('transactionsBody');
            const typeFilter = document.getElementById('txTypeFilter').value;
            const search = document.getElementById('txSearch').value.toLowerCase();

            let filtered = transactions;
            if (typeFilter) {
                filtered = filtered.filter(t => t.tx_type === typeFilter);
            }
            if (search) {
                filtered = filtered.filter(t =>
                    (t.description || '').toLowerCase().includes(search)
                );
            }

            // Compute running sum of units (oldestâ†’newest).
            // filtered is in DESC order (newest first), so accumulate from the end.
            const runningSums = new Array(filtered.length);
            let cumulative = 0;
            for (let i = filtered.length - 1; i >= 0; i--) {
                cumulative += (filtered[i].units || 0);
                runningSums[i] = cumulative;
            }

            tbody.innerHTML = filtered.map((t, i) => {
                const amount = t.amount || 0;
                const units = t.units || 0;
                const runSum = runningSums[i];
                return `
                    <tr>
                        <td>${t.tx_date}</td>
                        <td><span class="badge badge-${t.tx_type}">${t.tx_type}</span></td>
                        <td>${t.description || '-'}</td>
                        <td class="text-end ${amount < 0 ? 'negative' : ''} mask-amount">${amount ? formatCurrency(amount) : '-'}</td>
                        <td class="text-end ${units < 0 ? 'negative' : 'positive'}">${units.toFixed(3)}</td>
                        <td class="text-end">${t.nav ? t.nav.toFixed(4) : '-'}</td>
                        <td class="text-end">${(t.balance_units || 0).toFixed(3)}</td>
                        <td class="text-end">${runSum.toFixed(3)}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="openEditModal(${t.id})" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="openVersionModal(${t.id})" title="Version History">
                                <i class="bi bi-clock-history"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('txCount').textContent = `${filtered.length} transactions`;
        }

        function populateFilters(transactions) {
            const typeFilter = document.getElementById('txTypeFilter');
            const types = [...new Set(transactions.map(t => t.tx_type))].sort();

            typeFilter.innerHTML = '<option value="">All Types</option>' +
                types.map(t => `<option value="${t}">${t}</option>`).join('');
        }

        // Event listeners
        document.getElementById('txTypeFilter').addEventListener('change', () => displayTransactions(allTransactions));
        document.getElementById('txSearch').addEventListener('input', () => displayTransactions(allTransactions));

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 2
            }).format(value);
        }

        // Edit Modal Functions
        let editModal;
        let versionModal;

        async function openEditModal(txId) {
            try {
                const res = await fetch(`/api/transactions/${txId}`);
                const tx = await res.json();

                document.getElementById('editTxId').value = tx.id;
                document.getElementById('editDate').value = tx.tx_date;
                document.getElementById('editType').value = tx.tx_type;
                document.getElementById('editDescription').value = tx.description || '';
                document.getElementById('editAmount').value = tx.amount || 0;
                document.getElementById('editUnits').value = tx.units || 0;
                document.getElementById('editNav').value = tx.nav || 0;
                document.getElementById('editBalance').value = tx.balance_units || 0;
                document.getElementById('editComment').value = '';

                editModal = new bootstrap.Modal(document.getElementById('editModal'));
                editModal.show();
            } catch (error) {
                alert('Failed to load transaction: ' + error.message);
            }
        }

        async function saveTransaction() {
            const txId = document.getElementById('editTxId').value;
            const comment = document.getElementById('editComment').value.trim();

            if (!comment) {
                alert('Edit comment is required!');
                document.getElementById('editComment').focus();
                return;
            }

            const data = {
                tx_date: document.getElementById('editDate').value,
                tx_type: document.getElementById('editType').value,
                description: document.getElementById('editDescription').value,
                amount: parseFloat(document.getElementById('editAmount').value) || 0,
                units: parseFloat(document.getElementById('editUnits').value) || 0,
                nav: parseFloat(document.getElementById('editNav').value) || 0,
                balance_units: parseFloat(document.getElementById('editBalance').value) || 0,
                edit_comment: comment
            };

            try {
                const res = await fetch(`/api/transactions/${txId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await res.json();

                if (result.success) {
                    editModal.hide();
                    alert(result.message);
                    loadData(); // Reload transactions
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Failed to save: ' + error.message);
            }
        }

        async function openVersionModal(txId) {
            try {
                const res = await fetch(`/api/transactions/${txId}/versions`);
                const versions = await res.json();

                const container = document.getElementById('versionsList');

                if (versions.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-clock" style="font-size:2rem;"></i>
                            <p class="mt-2">No edit history for this transaction</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = versions.map(v => `
                        <div class="card mb-2">
                            <div class="card-header d-flex justify-content-between align-items-center py-2">
                                <span>
                                    <strong>Version ${v.version}</strong>
                                    <small class="text-muted ms-2">${v.edited_at}</small>
                                </span>
                                ${v.edited_by ? `<span class="badge bg-secondary">${v.edited_by}</span>` : ''}
                            </div>
                            <div class="card-body py-2">
                                <div class="mb-2">
                                    <strong>Comment:</strong> <em>${v.edit_comment}</em>
                                </div>
                                <div class="row small">
                                    <div class="col-3"><strong>Date:</strong> ${v.tx_date}</div>
                                    <div class="col-3"><strong>Type:</strong> ${v.tx_type}</div>
                                    <div class="col-3"><strong>Amount:</strong> ${formatCurrency(v.amount || 0)}</div>
                                    <div class="col-3"><strong>Units:</strong> ${(v.units || 0).toFixed(4)}</div>
                                </div>
                                <div class="row small mt-1">
                                    <div class="col-6"><strong>NAV:</strong> ${(v.nav || 0).toFixed(4)}</div>
                                    <div class="col-6"><strong>Balance:</strong> ${(v.balance_units || 0).toFixed(4)}</div>
                                </div>
                                <div class="small text-muted mt-1">
                                    <strong>Description:</strong> ${v.description || '-'}
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

                versionModal = new bootstrap.Modal(document.getElementById('versionModal'));
                versionModal.show();
            } catch (error) {
                alert('Failed to load versions: ' + error.message);
            }
        }

        // Investor mapping functions
        let currentFolioInfo = null;

        async function loadFolioInfo() {
            try {
                const res = await fetch(`/api/folios/${folioId}/info`);
                currentFolioInfo = await res.json();
                updateInvestorBadge();
            } catch (e) {
                console.error('Failed to load folio info:', e);
            }
        }

        function updateInvestorBadge() {
            const badge = document.getElementById('investorBadge');
            const unmapBtn = document.getElementById('unmapBtn');
            const mapBtn = document.getElementById('mapBtn');
            const reassignSelect = document.getElementById('reassignSelect');
            const reassignBtn = document.getElementById('reassignBtn');

            if (currentFolioInfo && currentFolioInfo.investor_id) {
                badge.innerHTML = `<span class="badge bg-light text-dark"><i class="bi bi-person-fill"></i> ${currentFolioInfo.investor_name}</span>`;
                unmapBtn.classList.remove('d-none');
                reassignSelect.classList.remove('d-none');
                reassignBtn.classList.remove('d-none');
                mapBtn.classList.add('d-none');
                loadInvestorsForReassign(currentFolioInfo.investor_id);
            } else {
                badge.innerHTML = `<span class="badge bg-warning text-dark">Unmapped</span>`;
                unmapBtn.classList.add('d-none');
                reassignSelect.classList.add('d-none');
                reassignBtn.classList.add('d-none');
                mapBtn.classList.remove('d-none');
            }
        }

        async function loadInvestorsForReassign(currentInvestorId) {
            try {
                const res = await fetch('/api/investors');
                const investors = await res.json();
                const select = document.getElementById('reassignSelect');
                select.innerHTML = '<option value="">-- Reassign to --</option>' +
                    investors
                        .filter(i => i.id !== currentInvestorId)
                        .map(i => `<option value="${i.id}">${i.name} (${i.pan || 'No PAN'})</option>`)
                        .join('');
            } catch (e) {
                console.error('Failed to load investors:', e);
            }
        }

        async function unmapFolio() {
            if (!confirm('Unmap this folio from the investor?')) return;
            try {
                const res = await fetch('/api/unmap-folio', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folio_id: folioId })
                });
                const result = await res.json();
                if (result.success) {
                    loadFolioInfo();
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Failed to unmap: ' + e.message);
            }
        }

        async function reassignFolio() {
            const newInvestorId = document.getElementById('reassignSelect').value;
            if (!newInvestorId) {
                alert('Select an investor to reassign to.');
                return;
            }
            if (!confirm('Reassign this folio to a different investor?')) return;
            try {
                const res = await fetch('/api/map-folios', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ investor_id: parseInt(newInvestorId), folio_ids: [folioId] })
                });
                const result = await res.json();
                if (result.success) {
                    loadFolioInfo();
                } else {
                    alert('Error: ' + (result.error || 'Unknown error'));
                }
            } catch (e) {
                alert('Failed to reassign: ' + e.message);
            }
        }

        async function showMapControls() {
            // For unmapped folios, show a dropdown to pick an investor
            try {
                const res = await fetch('/api/investors');
                const investors = await res.json();
                const select = document.getElementById('reassignSelect');
                select.innerHTML = '<option value="">-- Map to investor --</option>' +
                    investors.map(i => `<option value="${i.id}">${i.name} (${i.pan || 'No PAN'})</option>`).join('');
                select.classList.remove('d-none');
                document.getElementById('reassignBtn').classList.remove('d-none');
                document.getElementById('reassignBtn').innerHTML = '<i class="bi bi-link-45deg"></i> Map';
                document.getElementById('mapBtn').classList.add('d-none');
            } catch (e) {
                alert('Failed to load investors: ' + e.message);
            }
        }

        // Load data
        loadData();
        loadFolioInfo();
    </script>
    {% include '_feature_request_widget.html' %}
</body>
</html>
